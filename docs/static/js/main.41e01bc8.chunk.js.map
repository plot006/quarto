{"version":3,"sources":["widgets/Header.module.css","widgets/Controls.module.css","emulator/Screen.js","emulator/FrameTimer.js","emulator/Speakers.js","emulator/controllers/Controller.js","emulator/controllers/LocalController.js","locales/index.js","locales/strings.js","emulator/index.js","emulator/Emulator.js","widgets/BalloonMessage.js","widgets/Header.js","networking/transfer/Send.js","networking/transfer/Receive.js","networking/MasterSyncer.js","networking/SlaveSyncer.js","gui/InviteHeader.js","gui/JoinHeader.js","widgets/KeyBinding.js","gui/Settings.js","gui/Overlay.js","widgets/TVNoise.js","gui/helpers/index.js","gui/helpers/cleanQueryString.js","gui/helpers/ellipsize.js","widgets/Controls.js","widgets/SettingsButton.js","gui/PlayScreen.js","App.js","index.js","gui/PlayScreen.module.css","gui/Overlay.module.css","gui/Settings.module.css","widgets/BalloonMessage.module.css","events/bus.js","events/index.js","emulator/Screen.module.css","assets/halu.svg","widgets/SettingsButton.module.css","assets/quarto.nes","config.js"],"names":["module","exports","header","small","message","title","titleLogo","titleText","link","controls","controller","dpad","buttons","centered","Screen","props","_this","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","setBuffer","bind","assertThisInitialized","writeBuffer","_this2","react_default","a","createElement","className","styles","screen","width","height","ref","canvas","_initCanvas","buffer","y","x","i","buf32","imageData","data","set","buf8","context","putImageData","getContext","getImageData","fillStyle","fillRect","buf","ArrayBuffer","length","Uint8ClampedArray","Uint32Array","Component","FPS","FrameTimer","onFrame","fps","arguments","undefined","_run","_isRunning","_frameId","requestAnimationFrame","now","Date","elapsedTime","_lastTime","_interval","_fps","_startTime","cancelAnimationFrame","BUFFER_SIZE","Speakers","bufferSize","RingBuffer","writeSample","_onAudioProcess","audioCtx","window","AudioContext","scriptNode","createScriptProcessor","onaudioprocess","gainNode","createGain","gain","value","config","sound","connect","destination","bus","on","disconnect","close","catch","console","error","removeListener","sampleRate","left","right","size","deqN","enq","event","samples","outputBuffer","getChannelData","e","BITS","Controller","player","getNes","BUTTON_A","BUTTON_B","BUTTON_SELECT","BUTTON_START","BUTTON_UP","BUTTON_DOWN","BUTTON_LEFT","BUTTON_RIGHT","byte","sync","button","isPressed","nes","buttonDown","jsnes","buttonUp","source","LocalController","onStart","_processGamepadIfPossible","gamepad","_","first","navigator","getGamepads","mapping","id","pressed","_setButton","_onKeyDown","keyMap","key","_onKeyUp","immediateButtons","clone","options","input","esm_get","prototype","setInterval","addEventListener","removeEventListener","isMaster","strings","buffering","connected","connecting","copied","crtEffect","dragARomHere","enabled_false","enabled_true","errors","connectionFailed","invalidRom","serverIsDown","loading","pressStart","setDefaults","settings","shareThis","toPlayWithSomeone","waiting","yourXboxController","Emulator","localController","onStartPressed","remoteController","Screen_Screen","_initialize","attach","nextProps","stop","frameTimer","start","speakers","frame","onError","detach","_this3","_this$props","rom","bytes","Buffer","from","toString","NES","onAudioSample","getSampleRate","syncer","loadROM","emulator","ppu","clipToTvSize","BalloonMessage","children","classNames","balloon","character","src","haluImage","alt","Header","state","isEmpty","BalloonMessage_BalloonMessage","href","target","rel","tabIndex","Send","channel","_sent","_total","byteLength","send","remaining","Math","min","chunk","slice","Receive","_received","_appendBuffer","buffer1","buffer2","tmp","Uint8Array","STATE","MasterSyncer","_reset","_onData","masterBufferLimit","_state","_blindFrames","emit","_runFrame","_transfer","run","initializeRom","_emulator","_buffer","shift","remoteButtons","syncAll","toByte","_start","push","EventEmitter","SlaveSyncer","_hasPressedStart","_config$buffering","minBufferSize","maxBufferSize","_isBuffering","_ifBuffering","localButtons","COPIED_MESSAGE_TIME","InviteHeader","token","isDown","_copyLink","preventDefault","clipboard","writeText","setState","setTimeout","needsRom","_this$state","Header_Header","concat","onClick","onSyncer","quickp2p","createChannel","JoinHeader","joinChannel","KeyBinding","_onAssign","isAssigning","onAssignCancel","onAssignStart","displayName","_this$props$verticalM","verticalMirror","type","style","transform","display","BUTTONS","name","Settings","mappingButton","_onClose","_onSetDefaults","reset","_notify","oldKey","findKey","it","newKey","save","closeButton","setDefaultsButton","soundOptions","map","checked","onChange","_update","bufferingOptions","crt","KeyBinding_KeyBinding","property","container","document","querySelector","classList","add","remove","forceUpdate","Overlay","isSettingsMenuOpen","isLoading","isVisible","overlay","show","loader","dark","Settings_Settings","react_loader_spinner_default","color","TVNoise","borderRadius","self","toggle","loop","ctx","w","h","idata","createImageData","buffer32","len","random","noise","helpers","cleanQueryString","url","location","replace","substring","indexOf","history","replaceState","ellipsize","string","limit","FRIENDLY_NAMES","ArrowLeft","ArrowRight","ArrowUp","ArrowDown"," ","Controls","_onGamepadConnected","usesGamepad","upKey","_keyFor","isUpArrow","Fragment","element","_format","toUpperCase","SettingsButton","_onClick","require","default","PlayScreen","_onSyncer","_loadRom","initializeEmulator","_onInitLoad","path","callback","handleProgress","req","XMLHttpRequest","open","overrideMimeType","onload","status","responseText","match","Error","statusText","onerror","onprogress","loadBinary","quarto","err","c","charCodeAt","_onFileDrop","file","dataTransfer","files","reader","FileReader","result","updateRom","readAsArrayBuffer","_ignore","stopPropagation","_onStartPressed","_onError","app","JoinHeader_JoinHeader","InviteHeader_InviteHeader","main","gameContainer","Overlay_Overlay","src_emulator","TVNoise_TVNoise","Controls_Controls","menu","SettingsButton_SettingsButton","noop","setStore","SimpleStore","App","hash","startsWith","PlayScreen_PlayScreen","inviteToken","_listener","querystring","parse","search","PureComponent","ReactDOM","render","App_App","getElementById","__webpack_require__","p","Config","C_user_github_nestation_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__","defaultOptions","load","localStorage","setItem","JSON","stringify","getItem","find","d","Delete","Enter","__webpack_exports__"],"mappings":"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","file":"static/js/main.41e01bc8.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"header\":\"Header_header__2Xem3\",\"small\":\"Header_small__2QZXS\",\"message\":\"Header_message__2D7oG\",\"title\":\"Header_title__2I8-3\",\"titleLogo\":\"Header_titleLogo__1D8dB\",\"titleText\":\"Header_titleText__cwBkS\",\"link\":\"Header_link__3Sm1O\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"controls\":\"Controls_controls__3I2V2\",\"title\":\"Controls_title__2uNHE\",\"controller\":\"Controls_controller__2JRSJ\",\"dpad\":\"Controls_dpad__3PJDR\",\"buttons\":\"Controls_buttons__WaJCY\",\"centered\":\"Controls_centered__I9512\"};","import React, { Component } from \"react\";\nimport styles from \"./Screen.module.css\";\n\nconst SCREEN_WIDTH = 256;\nconst SCREEN_HEIGHT = 240;\nconst FULL_ALPHA = 0xff000000;\n\nexport default class Screen extends Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.setBuffer = this.setBuffer.bind(this);\n\t\tthis.writeBuffer = this.writeBuffer.bind(this);\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<canvas\n\t\t\t\tclassName={styles.screen}\n\t\t\t\twidth={SCREEN_WIDTH}\n\t\t\t\theight={SCREEN_HEIGHT}\n\t\t\t\tref={(canvas) => {\n\t\t\t\t\tif (canvas) this._initCanvas(canvas);\n\t\t\t\t}}\n\t\t\t/>\n\t\t);\n\t}\n\n\tsetBuffer(buffer) {\n\t\tfor (let y = 0; y < SCREEN_HEIGHT; ++y) {\n\t\t\tfor (let x = 0; x < SCREEN_WIDTH; ++x) {\n\t\t\t\tconst i = y * 256 + x;\n\t\t\t\t// Convert pixel from NES BGR to canvas ABGR\n\t\t\t\tthis.buf32[i] = FULL_ALPHA | buffer[i];\n\t\t\t}\n\t\t}\n\t}\n\n\twriteBuffer() {\n\t\tthis.imageData.data.set(this.buf8);\n\t\tthis.context.putImageData(this.imageData, 0, 0);\n\t}\n\n\t_initCanvas(canvas) {\n\t\tthis.context = canvas.getContext(\"2d\");\n\t\tthis.imageData = this.context.getImageData(\n\t\t\t0,\n\t\t\t0,\n\t\t\tSCREEN_WIDTH,\n\t\t\tSCREEN_HEIGHT\n\t\t);\n\n\t\t// Set alpha to opaque\n\t\tthis.context.fillStyle = \"black\";\n\t\tthis.context.fillRect(0, 0, SCREEN_WIDTH, SCREEN_HEIGHT);\n\n\t\t// Buffer to write on next animation frame\n\t\tthis.buf = new ArrayBuffer(this.imageData.data.length);\n\n\t\t// Get the canvas buffer in 8bit and 32bit\n\t\tthis.buf8 = new Uint8ClampedArray(this.buf);\n\t\tthis.buf32 = new Uint32Array(this.buf);\n\n\t\t// Set alpha\n\t\tfor (let i = 0; i < this.buf32.length; ++i) {\n\t\t\tthis.buf32[i] = FULL_ALPHA;\n\t\t}\n\t}\n}\n","const FPS = 60.098;\n\nexport default class FrameTimer {\n\tconstructor(onFrame, fps = FPS) {\n\t\tthis.onFrame = onFrame;\n\n\t\tthis._fps = fps;\n\t\tthis._interval = 1000 / fps;\n\t\tthis._lastTime = Date.now();\n\t\tthis._startTime = this._lastTime;\n\t\tthis._isRunning = false;\n\t}\n\n\tstart() {\n\t\tthis._isRunning = true;\n\t\tthis._run();\n\t}\n\n\tstop() {\n\t\tthis._isRunning = false;\n\t\tcancelAnimationFrame(this._frameId);\n\t}\n\n\t_run = () => {\n\t\tif (!this._isRunning) return;\n\t\tthis._frameId = requestAnimationFrame(this._run);\n\n\t\tconst now = Date.now();\n\t\tconst elapsedTime = now - this._lastTime;\n\n\t\tif (elapsedTime > this._interval) {\n\t\t\tthis._lastTime = now - (elapsedTime % this._interval);\n\t\t\tthis.onFrame();\n\t\t}\n\t};\n}\n","import RingBuffer from \"ringbufferjs\";\nimport config from \"../config\";\nimport bus from \"../events\";\n\nconst BUFFER_SIZE = 8192;\nconst DEFAULT_SAMPLE_RATE = 44100;\n\nexport default class Speakers {\n\tconstructor() {\n\t\tthis.bufferSize = BUFFER_SIZE;\n\t\tthis.buffer = new RingBuffer(this.bufferSize * 2);\n\n\t\tthis.writeSample = this.writeSample.bind(this);\n\t\tthis._onAudioProcess = this._onAudioProcess.bind(this);\n\t}\n\n\tstart() {\n\t\tif (this.audioCtx) return;\n\t\tif (!window.AudioContext) return; // (audio is not supported)\n\n\t\tthis.audioCtx = new window.AudioContext();\n\t\tthis.scriptNode = this.audioCtx.createScriptProcessor(1024, 0, 2);\n\t\tthis.scriptNode.onaudioprocess = this._onAudioProcess;\n\t\tthis.gainNode = this.audioCtx.createGain();\n\t\tthis.gainNode.gain.value = config.sound.gain;\n\t\tthis.gainNode.connect(this.audioCtx.destination);\n\t\tthis.scriptNode.connect(this.gainNode);\n\n\t\tbus.on(\n\t\t\t\"volume\",\n\t\t\t(gain) => this.gainNode && (this.gainNode.gain.value = gain)\n\t\t);\n\t}\n\n\tstop() {\n\t\tif (this.scriptNode) {\n\t\t\tthis.gainNode.disconnect(this.audioCtx.destination);\n\t\t\tthis.scriptNode.disconnect(this.gainNode);\n\t\t\tthis.scriptNode.onaudioprocess = null;\n\t\t\tthis.scriptNode = null;\n\t\t\tthis.gainNode = null;\n\t\t}\n\n\t\tif (this.audioCtx) {\n\t\t\tthis.audioCtx.close().catch(console.error);\n\t\t\tthis.audioCtx = null;\n\t\t}\n\n\t\tbus.removeListener(\"volume\");\n\t}\n\n\tgetSampleRate() {\n\t\tif (!window.AudioContext) return DEFAULT_SAMPLE_RATE;\n\n\t\tconst context = new window.AudioContext();\n\t\tconst sampleRate = context.sampleRate;\n\t\tcontext.close();\n\n\t\treturn sampleRate;\n\t}\n\n\twriteSample(left, right) {\n\t\tif (this.buffer.size() / 2 >= this.bufferSize) {\n\t\t\t// buffer overrun\n\t\t\tthis.buffer.deqN(this.bufferSize / 2);\n\t\t}\n\n\t\tthis.buffer.enq(left);\n\t\tthis.buffer.enq(right);\n\t}\n\n\t_onAudioProcess(event) {\n\t\tconst left = event.outputBuffer.getChannelData(0);\n\t\tconst right = event.outputBuffer.getChannelData(1);\n\t\tconst size = left.length;\n\n\t\tlet samples;\n\t\ttry {\n\t\t\tsamples = this.buffer.deqN(size * 2);\n\t\t} catch (e) {\n\t\t\t// buffer underrun (needed {size}, got {this.buffer.size() / 2})\n\t\t\t// ignore empty buffers... assume audio has just stopped\n\n\t\t\tfor (let i = 0; i < size; i++) {\n\t\t\t\tleft[i] = 0;\n\t\t\t\tright[i] = 0;\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let i = 0; i < size; i++) {\n\t\t\tleft[i] = samples[i * 2];\n\t\t\tright[i] = samples[i * 2 + 1];\n\t\t}\n\t}\n}\n","import jsnes from \"jsnes\";\n\nconst BITS = [\n\t0b00000001,\n\t0b00000010,\n\t0b00000100,\n\t0b00001000,\n\t0b00010000,\n\t0b00100000,\n\t0b01000000,\n\t0b10000000\n];\n\nexport default class Controller {\n\tconstructor(player = 1, getNes) {\n\t\tthis.player = player;\n\t\tthis.getNes = getNes;\n\n\t\tthis.buttons = {\n\t\t\tBUTTON_A: false,\n\t\t\tBUTTON_B: false,\n\t\t\tBUTTON_SELECT: false,\n\t\t\tBUTTON_START: false,\n\t\t\tBUTTON_UP: false,\n\t\t\tBUTTON_DOWN: false,\n\t\t\tBUTTON_LEFT: false,\n\t\t\tBUTTON_RIGHT: false\n\t\t};\n\t}\n\n\tsyncAll(byte) {\n\t\tthis.sync(\"BUTTON_A\", !!(byte & BITS[0]));\n\t\tthis.sync(\"BUTTON_B\", !!(byte & BITS[1]));\n\t\tthis.sync(\"BUTTON_SELECT\", !!(byte & BITS[2]));\n\t\tthis.sync(\"BUTTON_START\", !!(byte & BITS[3]));\n\t\tthis.sync(\"BUTTON_UP\", !!(byte & BITS[4]));\n\t\tthis.sync(\"BUTTON_DOWN\", !!(byte & BITS[5]));\n\t\tthis.sync(\"BUTTON_LEFT\", !!(byte & BITS[6]));\n\t\tthis.sync(\"BUTTON_RIGHT\", !!(byte & BITS[7]));\n\t}\n\n\tsync(button, isPressed) {\n\t\tconst nes = this.getNes();\n\n\t\tif (!this.buttons[button] && isPressed) {\n\t\t\tthis.buttons[button] = true;\n\t\t\tnes.buttonDown(this.player, jsnes.Controller[button]);\n\t\t} else if (this.buttons[button] && !isPressed) {\n\t\t\tthis.buttons[button] = false;\n\t\t\tnes.buttonUp(this.player, jsnes.Controller[button]);\n\t\t}\n\t}\n\n\ttoByte(source = this.buttons) {\n\t\treturn (\n\t\t\t(source.BUTTON_A && BITS[0]) |\n\t\t\t(source.BUTTON_B && BITS[1]) |\n\t\t\t(source.BUTTON_SELECT && BITS[2]) |\n\t\t\t(source.BUTTON_START && BITS[3]) |\n\t\t\t(source.BUTTON_UP && BITS[4]) |\n\t\t\t(source.BUTTON_DOWN && BITS[5]) |\n\t\t\t(source.BUTTON_LEFT && BITS[6]) |\n\t\t\t(source.BUTTON_RIGHT && BITS[7])\n\t\t);\n\t}\n}\n","import Controller from \"./Controller\";\nimport config from \"../../config\";\nimport bus from \"../../events\";\nimport _ from \"lodash\";\n\nexport default class LocalController extends Controller {\n\tconstructor(player, getNes, onStart = () => {}) {\n\t\tsuper(player, getNes);\n\n\t\tthis.immediateButtons = _.clone(this.buttons);\n\t\tthis.onStart = onStart;\n\t\tthis.keyMap = config.options.input;\n\t}\n\n\ttoByte() {\n\t\treturn super.toByte(this.immediateButtons);\n\t}\n\n\tattach() {\n\t\tsetInterval(() => {\n\t\t\tthis._processGamepadIfPossible();\n\t\t}, 10);\n\n\t\twindow.addEventListener(\"keydown\", this._onKeyDown);\n\t\twindow.addEventListener(\"keyup\", this._onKeyUp);\n\t\tbus.on(\"keymap-updated\", () => (this.keyMap = config.options.input));\n\t}\n\n\tdetach() {\n\t\twindow.removeEventListener(\"keydown\", this._onKeyDown);\n\t\twindow.removeEventListener(\"keyup\", this._onKeyUp);\n\t\tbus.removeListener(\"keymap-updated\");\n\t}\n\n\t_processGamepadIfPossible = () => {\n\t\tconst gamepad = _.first(navigator.getGamepads());\n\t\tif (!gamepad || gamepad.mapping !== \"standard\") return;\n\n\t\tconst isPressed = (id) => gamepad.buttons[id].pressed;\n\n\t\tthis._setButton(\"BUTTON_A\", isPressed(1));\n\t\tthis._setButton(\"BUTTON_B\", isPressed(0));\n\t\tthis._setButton(\"BUTTON_SELECT\", isPressed(8));\n\t\tthis._setButton(\"BUTTON_START\", isPressed(9));\n\t\tthis._setButton(\"BUTTON_UP\", isPressed(12));\n\t\tthis._setButton(\"BUTTON_DOWN\", isPressed(13));\n\t\tthis._setButton(\"BUTTON_LEFT\", isPressed(14));\n\t\tthis._setButton(\"BUTTON_RIGHT\", isPressed(15));\n\t};\n\n\t_onKeyDown = (e) => {\n\t\tconst button = this.keyMap[e.key];\n\t\tif (!button) return;\n\n\t\tthis._setButton(button, true);\n\t};\n\n\t_onKeyUp = (e) => {\n\t\tconst button = this.keyMap[e.key];\n\t\tif (!button) return;\n\n\t\tthis._setButton(button, false);\n\t};\n\n\t_setButton(button, isPressed) {\n\t\tif (button === \"BUTTON_START\" && isPressed) this.onStart();\n\n\t\tthis.immediateButtons[button] = isPressed;\n\t\tif (this.isMaster) this.sync(button, isPressed);\n\t}\n\n\tget isMaster() {\n\t\treturn this.player === 1;\n\t}\n}\n","import strings from \"./strings\";\n\nexport default strings;\n","export default {\n\tbuffering: \"Buffering\",\n\tconnected: \"Connected!\",\n\tconnecting: \"Connecting...\",\n\tcontrols: \"-Controls-\",\n\tcopied: \"Copied!\",\n\tcrtEffect: \"CRT Effect\",\n\tdragARomHere: \"Drag a NES rom file here!\",\n\tenabled_false: \"Disabled\",\n\tenabled_true: \"Enabled\",\n\terrors: {\n\t\tconnectionFailed: \"CONNECTION FAILED :(\",\n\t\tinvalidRom: \"INVALID ROM :(\",\n\t\tserverIsDown: \"The server is down :(\"\n\t},\n\tinput: \"Input\",\n\tlink: \"link\",\n\tloading: \"Loading...\",\n\tpressStart: \"PRESS START\",\n\tsetDefaults: \"Set defaults\",\n\tsettings: \"Settings\",\n\tsound: \"Sound\",\n\tshareThis: \"Share this\",\n\ttoPlayWithSomeone: \"to play with someone!\",\n\twaiting: \"WAITING...\",\n\tyourXboxController: \"Your Xbox controller\"\n};\n","import Emulator from \"./Emulator\";\n\nexport default Emulator;\n","import React, { Component } from \"react\";\nimport { Buffer } from \"buffer\";\nimport Screen from \"./Screen\";\nimport FrameTimer from \"./FrameTimer\";\nimport Speakers from \"./Speakers\";\nimport { Controller, LocalController } from \"./controllers\";\nimport strings from \"../locales\";\nimport jsnes, { NES } from \"jsnes\";\n\nexport default class Emulator extends Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tconst getNes = () => this.nes;\n\t\tthis.localController = new LocalController(1, getNes, props.onStartPressed);\n\t\tthis.remoteController = new Controller(2, getNes);\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<Screen\n\t\t\t\tref={(screen) => {\n\t\t\t\t\tif (screen) this._initialize(screen);\n\t\t\t\t}}\n\t\t\t/>\n\t\t);\n\t}\n\n\tcomponentDidMount() {\n\t\tthis.localController.attach();\n\t}\n\n\tcomponentWillUpdate(nextProps) {\n\t\tthis.stop();\n\t}\n\n\tstart() {\n\t\tthis.frameTimer.start();\n\t\tthis.speakers.start();\n\t}\n\n\tstop() {\n\t\tthis.frameTimer.stop();\n\t\tthis.speakers.stop();\n\t}\n\n\tframe() {\n\t\ttry {\n\t\t\tthis.nes.frame();\n\t\t\tthis.screen.writeBuffer();\n\t\t} catch (e) {\n\t\t\tthis.props.onError(strings.errors.invalidRom, false);\n\t\t}\n\t}\n\n\tcomponentWillUnmount() {\n\t\tthis.stop();\n\t\tthis.localController.detach();\n\t}\n\n\t_initialize(screen) {\n\t\tconst { rom, onError } = this.props;\n\t\tif (!rom) return;\n\t\tconst bytes = Buffer.from(rom).toString(\"binary\");\n\n\t\tthis.screen = screen;\n\n\t\tthis.speakers = new Speakers();\n\n\t\tthis.nes = new NES({\n\t\t\tonFrame: this.screen.setBuffer,\n\t\t\tonAudioSample: this.speakers.writeSample,\n\t\t\tsampleRate: this.speakers.getSampleRate()\n\t\t});\n\n\t\tthis.frameTimer = new FrameTimer(() => {\n\t\t\tconst { syncer } = this.props;\n\n\t\t\tif (syncer) syncer.sync();\n\t\t\telse this.frame();\n\t\t});\n\n\t\t// Load ROM data as a string and start\n\t\ttry {\n\t\t\tthis.nes.loadROM(bytes);\n\t\t} catch (e) {\n\t\t\tonError(strings.errors.invalidRom, false);\n\t\t}\n\n\t\t// DEBUG\n\t\twindow.emulator = this;\n\t\twindow.jsnes = jsnes;\n\n\t\t// CLIP OFF.\n\t\tthis.nes.ppu.clipToTvSize = false;\n\t}\n}\n","import React, { Component } from \"react\";\nimport styles from \"./BalloonMessage.module.css\";\nimport haluImage from \"../assets/halu.svg\";\nimport classNames from \"classnames\";\n\nexport default class BalloonMessage extends Component {\n\trender() {\n\t\tconst { children } = this.props;\n\n\t\treturn (\n\t\t\t<section className=\"message -left\">\n\t\t\t\t<div\n\t\t\t\t\tclassName={classNames(\n\t\t\t\t\t\tstyles.balloon,\n\t\t\t\t\t\t\"nes-balloon\",\n\t\t\t\t\t\t\"from-left\",\n\t\t\t\t\t\t\"is-small\"\n\t\t\t\t\t)}\n\t\t\t\t>\n\t\t\t\t\t<p>{children}</p>\n\t\t\t\t</div>\n\t\t\t\t<br />\n\t\t\t\t<img className={styles.character} src={haluImage} alt=\"character\" />\n\t\t\t</section>\n\t\t);\n\t}\n}\n","import React, { Component } from \"react\";\nimport BalloonMessage from \"./BalloonMessage\";\nimport styles from \"./Header.module.css\";\nimport classNames from \"classnames\";\nimport _ from \"lodash\";\n\nexport default class Header extends Component {\n\tstate = { bytes: null };\n\n\trender() {\n\t\tconst { children } = this.props;\n\n\t\treturn (\n\t\t\t<div className={styles.header}>\n\t\t\t\t<div className={styles.small}>\n\t\t\t\t\t{!_.isEmpty(children) && (\n\t\t\t\t\t\t<BalloonMessage\n\t\t\t\t\t\t\tclassName={classNames(styles.message, styles.small)}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{children}\n\t\t\t\t\t\t</BalloonMessage>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\n\t\t\t\t<h2 className={styles.title}>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<i className={classNames(styles.titleLogo, \"nes-logo\")} />\n\t\t\t\t\t\t<span className={styles.titleText}>NEStation</span>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<a\n\t\t\t\t\t\t\thref=\"https://github.com/rodri042/nestation#nestation\"\n\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\trel=\"noopener noreferrer\"\n\t\t\t\t\t\t\ttabIndex=\"-1\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<i\n\t\t\t\t\t\t\t\tclassName={classNames(\n\t\t\t\t\t\t\t\t\tstyles.link,\n\t\t\t\t\t\t\t\t\tstyles.titleLogo,\n\t\t\t\t\t\t\t\t\t\"nes-octocat\"\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t</h2>\n\t\t\t</div>\n\t\t);\n\t}\n}\n","const CHUNK_SIZE = 1024;\n\nexport default class Send {\n\tconstructor(rom, channel) {\n\t\tthis.rom = rom;\n\t\tthis.channel = channel;\n\n\t\tthis._sent = 0;\n\t\tthis._total = rom.byteLength;\n\t}\n\n\trun() {\n\t\tif (this._sent === this._total) {\n\t\t\tthis.channel.send(\"end\");\n\t\t\treturn true;\n\t\t}\n\n\t\tconst remaining = this._total - this._sent;\n\t\tconst size = Math.min(CHUNK_SIZE, remaining);\n\t\tconst chunk = this.rom.slice(this._sent, this._sent + size);\n\n\t\tthis._sent += size;\n\t\tthis.channel.send(chunk);\n\t}\n\n\tget transferred() {\n\t\treturn this._sent;\n\t}\n}\n","export default class Receive {\n\tconstructor(channel) {\n\t\tthis.rom = new ArrayBuffer();\n\t\tthis.channel = channel;\n\n\t\tthis._received = 0;\n\t}\n\n\trun(bytes) {\n\t\tthis.rom = this._appendBuffer(this.rom, bytes);\n\n\t\tthis._received += bytes.byteLength;\n\t\tthis.channel.send(\"next\");\n\t}\n\n\t_appendBuffer(buffer1, buffer2) {\n\t\tvar tmp = new Uint8Array(buffer1.byteLength + buffer2.byteLength);\n\t\ttmp.set(new Uint8Array(buffer1), 0);\n\t\ttmp.set(new Uint8Array(buffer2), buffer1.byteLength);\n\t\treturn tmp.buffer;\n\t}\n\n\tget transferred() {\n\t\treturn this._received;\n\t}\n}\n","import EventEmitter from \"eventemitter3\";\nimport { Send } from \"./transfer\";\nimport config from \"../config\";\nimport bus from \"../events\";\nimport strings from \"../locales\";\n\nconst STATE = {\n\tSENDING_ROM: 0,\n\tPLAYING: 1\n};\n\nexport default class MasterSyncer extends EventEmitter {\n\tconstructor(channel) {\n\t\tsuper();\n\n\t\tthis.channel = channel;\n\t\tthis._reset();\n\t\tthis.channel.on(\"data\", (bytes) => this._onData(bytes));\n\t}\n\n\tsync() {\n\t\tconst { masterBufferLimit } = config.buffering;\n\n\t\tif (\n\t\t\tthis._state !== STATE.PLAYING ||\n\t\t\tthis._blindFrames > masterBufferLimit\n\t\t) {\n\t\t\tbus.emit(\"isLoading\", true);\n\t\t\treturn;\n\t\t}\n\n\t\tbus.emit(\"isLoading\", false);\n\t\tthis._runFrame();\n\t}\n\n\tinitializeRom(rom) {\n\t\tthis._transfer = new Send(rom, this.channel);\n\t\tthis._transfer.run();\n\t\tthis.emit(\"rom\", rom);\n\t}\n\n\tupdateRom(rom) {\n\t\tthis.channel.send(\"new-rom\");\n\t\tthis._reset();\n\t\tthis.initializeRom(rom);\n\t}\n\n\tinitializeEmulator(emulator) {\n\t\tthis._emulator = emulator;\n\n\t\temulator.localController.player = 1;\n\t\temulator.remoteController.player = 2;\n\t}\n\n\tonStartPressed() {}\n\n\t_start() {\n\t\tthis._transfer = null;\n\t\tthis._state = STATE.PLAYING;\n\t\tthis.emit(\"start\");\n\t\tbus.emit(\"message\", null);\n\t\tbus.emit(\"isLoading\", false);\n\t}\n\n\t_runFrame() {\n\t\tconst { masterBufferLimit } = config.buffering;\n\n\t\t// buffer overrun\n\t\tif (this._buffer.length > masterBufferLimit) {\n\t\t\tfor (let i = 0; i < this._buffer.length - masterBufferLimit; i++)\n\t\t\t\tthis._buffer.shift();\n\t\t}\n\n\t\tconst bytes = this._buffer.shift();\n\t\tif (bytes) {\n\t\t\t// normal scenario\n\t\t\tconst remoteButtons = new Uint8Array(bytes)[0];\n\t\t\tthis._emulator.remoteController.syncAll(remoteButtons);\n\t\t} else {\n\t\t\t// buffer underrun, do nothing (assume previous input)\n\t\t}\n\n\t\tconst buffer = new Uint8Array(2);\n\t\tbuffer[0] = this._emulator.localController.toByte();\n\t\tbuffer[1] = this._emulator.remoteController.toByte();\n\t\tthis.channel.send(buffer);\n\t\tthis._blindFrames++;\n\n\t\tthis._emulator.frame();\n\t}\n\n\t_onData(bytes) {\n\t\tswitch (this._state) {\n\t\t\tcase STATE.SENDING_ROM:\n\t\t\t\tif (bytes === \"next\") {\n\t\t\t\t\tconst hasEnded = this._transfer.run();\n\t\t\t\t\tif (hasEnded) bus.emit(\"message\", strings.waiting);\n\t\t\t\t} else if (bytes === \"start\") this._start();\n\n\t\t\t\tbreak;\n\t\t\tcase STATE.PLAYING:\n\t\t\t\tthis._buffer.push(bytes);\n\t\t\t\tthis._blindFrames = 0;\n\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t}\n\t}\n\n\t_reset() {\n\t\tthis._state = STATE.SENDING_ROM;\n\t\tthis._transfer = null;\n\t\tthis._buffer = [];\n\t\tthis._blindFrames = 0;\n\n\t\tbus.emit(\"isLoading\", true);\n\t}\n}\n","import EventEmitter from \"eventemitter3\";\nimport { Receive } from \"./transfer\";\nimport config from \"../config\";\nimport bus from \"../events\";\nimport strings from \"../locales\";\n\nconst STATE = {\n\tRECEIVING_ROM: 0,\n\tWAITING_START: 1,\n\tPLAYING: 2\n};\n\nexport default class SlaveSyncer extends EventEmitter {\n\tconstructor(channel) {\n\t\tsuper();\n\n\t\tthis.channel = channel;\n\t\tthis._reset();\n\t\tthis.channel.on(\"data\", (bytes) => this._onData(bytes));\n\t\tthis._hasPressedStart = false;\n\t}\n\n\tsync() {\n\t\tconst { minBufferSize, maxBufferSize } = config.buffering;\n\n\t\t// buffer underrun\n\t\tif (this._buffer.length < minBufferSize) {\n\t\t\tthis._isBuffering = true;\n\t\t\tbus.emit(\"isLoading\", true);\n\t\t\treturn;\n\t\t}\n\n\t\t// buffer overrun\n\t\tif (this._buffer.length > maxBufferSize) {\n\t\t\tfor (let i = 0; i < this._buffer.length - maxBufferSize; i++)\n\t\t\t\tthis._runFrame();\n\t\t}\n\n\t\t// normal scenario\n\t\tif (this._isBuffering && this._buffer.length < maxBufferSize) return;\n\t\telse this._runFrame();\n\t}\n\n\tinitializeRom(rom) {}\n\n\tupdateRom(rom) {}\n\n\tinitializeEmulator(emulator) {\n\t\tthis._emulator = emulator;\n\n\t\tbus.emit(\"isLoading\", false);\n\t\temulator.localController.player = 2;\n\t\temulator.remoteController.player = 1;\n\t}\n\n\tonStartPressed() {\n\t\tif (this._state === STATE.WAITING_START) {\n\t\t\tthis._hasPressedStart = true;\n\t\t\tthis._start();\n\t\t}\n\t}\n\n\t_start() {\n\t\tthis.emit(\"start\");\n\t\tthis.channel.send(\"start\");\n\t\tbus.emit(\"message\", null);\n\t\tthis._state = STATE.PLAYING;\n\t}\n\n\t_runFrame() {\n\t\tthis._ifBuffering = false;\n\t\tbus.emit(\"isLoading\", false);\n\n\t\tconst bytes = this._buffer.shift();\n\t\tconst remoteButtons = new Uint8Array(bytes)[0];\n\t\tconst localButtons = new Uint8Array(bytes)[1];\n\t\tthis._emulator.remoteController.syncAll(remoteButtons);\n\t\tthis._emulator.localController.syncAll(localButtons);\n\n\t\tthis._emulator.frame();\n\t}\n\n\t_onData(bytes) {\n\t\tif (bytes === \"new-rom\") {\n\t\t\tthis._reset();\n\t\t\treturn;\n\t\t}\n\n\t\tswitch (this._state) {\n\t\t\tcase STATE.RECEIVING_ROM:\n\t\t\t\tif (bytes === \"end\") {\n\t\t\t\t\tthis.emit(\"rom\", this._transfer.rom);\n\t\t\t\t\tthis._transfer = null;\n\n\t\t\t\t\tif (this._hasPressedStart) this._start();\n\t\t\t\t\telse {\n\t\t\t\t\t\tbus.emit(\"message\", strings.pressStart);\n\t\t\t\t\t\tthis._state = STATE.WAITING_START;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis._transfer.run(bytes);\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\tcase STATE.PLAYING:\n\t\t\t\tif (!this._emulator) return;\n\n\t\t\t\tthis._buffer.push(bytes);\n\n\t\t\t\tconst buffer = new Uint8Array(1);\n\t\t\t\tbuffer[0] = this._emulator.localController.toByte();\n\t\t\t\tthis.channel.send(buffer);\n\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t}\n\t}\n\n\t_reset() {\n\t\tthis._state = STATE.RECEIVING_ROM;\n\t\tthis._transfer = new Receive(this.channel);\n\t\tthis._isBuffering = false;\n\t\tthis._buffer = [];\n\n\t\tbus.emit(\"isLoading\", true);\n\t}\n}\n","import React, { Component } from \"react\";\nimport Header from \"../widgets/Header\";\nimport { MasterSyncer } from \"../networking\";\nimport quickp2p from \"quickp2p\";\nimport strings from \"../locales\";\n\nconst COPIED_MESSAGE_TIME = 1000;\n\nexport default class InviteHeader extends Component {\n\tstate = { token: null, copied: false, isDown: false };\n\n\trender() {\n\t\tconst { needsRom } = this.props;\n\t\tconst { token, copied, isDown } = this.state;\n\n\t\treturn (\n\t\t\t<Header>\n\t\t\t\t{copied ? (\n\t\t\t\t\t<span>{strings.copied}</span>\n\t\t\t\t) : needsRom ? (\n\t\t\t\t\t<span>{strings.dragARomHere}</span>\n\t\t\t\t) : token ? (\n\t\t\t\t\t<span>\n\t\t\t\t\t\t{strings.shareThis}{\" \"}\n\t\t\t\t\t\t<a\n\t\t\t\t\t\t\thref={`?token=${token}#/join`}\n\t\t\t\t\t\t\tonClick={this._copyLink}\n\t\t\t\t\t\t\ttabIndex=\"-1\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{strings.link}\n\t\t\t\t\t\t</a>{\" \"}\n\t\t\t\t\t\t{strings.toPlayWithSomeone}\n\t\t\t\t\t</span>\n\t\t\t\t) : isDown ? (\n\t\t\t\t\t<span>{strings.errors.serverIsDown}</span>\n\t\t\t\t) : (\n\t\t\t\t\t<span>{strings.loading}</span>\n\t\t\t\t)}\n\t\t\t</Header>\n\t\t);\n\t}\n\n\tasync componentDidUpdate(nextProps) {\n\t\tconst { needsRom, onSyncer, onError } = this.props;\n\t\tif (needsRom || this.channel) return;\n\n\t\ttry {\n\t\t\tthis.channel = await quickp2p.createChannel();\n\t\t\tthis.channel\n\t\t\t\t.on(\"connected\", () => {\n\t\t\t\t\tonSyncer(new MasterSyncer(this.channel));\n\t\t\t\t})\n\t\t\t\t.on(\"disconnected\", onError);\n\t\t\tthis.setState({ token: this.channel.token, isDown: false });\n\t\t} catch (e) {\n\t\t\tthis.setState({ isDown: true });\n\t\t}\n\t}\n\n\t_copyLink = (e) => {\n\t\te.preventDefault();\n\n\t\tnavigator.clipboard.writeText(e.target.href);\n\t\tthis.setState({ copied: true });\n\t\tsetTimeout(() => {\n\t\t\tthis.setState({ copied: false });\n\t\t}, COPIED_MESSAGE_TIME);\n\t};\n}\n","import React, { Component } from \"react\";\nimport Header from \"../widgets/Header\";\nimport { SlaveSyncer } from \"../networking\";\nimport quickp2p from \"quickp2p\";\nimport strings from \"../locales\";\n\nexport default class JoinHeader extends Component {\n\trender() {\n\t\treturn (\n\t\t\t<Header>\n\t\t\t\t<span>{strings.connecting}</span>\n\t\t\t</Header>\n\t\t);\n\t}\n\n\tasync componentDidMount() {\n\t\tconst { onSyncer, onError } = this.props;\n\n\t\ttry {\n\t\t\tconst channel = await quickp2p.joinChannel(this.props.token);\n\t\t\tchannel\n\t\t\t\t.on(\"connected\", () => {\n\t\t\t\t\tonSyncer(new SlaveSyncer(channel));\n\t\t\t\t})\n\t\t\t\t.on(\"disconnected\", onError);\n\t\t} catch (e) {\n\t\t\tonError();\n\t\t}\n\t}\n}\n","import React, { Component } from \"react\";\n\nexport default class KeyBinding extends Component {\n\trender() {\n\t\tconst { displayName, isAssigning, verticalMirror = false } = this.props;\n\n\t\treturn (\n\t\t\t<button\n\t\t\t\ttype=\"button\"\n\t\t\t\tclassName=\"nes-btn is-primary\"\n\t\t\t\tonClick={this._onAssign}\n\t\t\t>\n\t\t\t\t<span\n\t\t\t\t\tstyle={\n\t\t\t\t\t\tverticalMirror\n\t\t\t\t\t\t\t? { transform: \"scale(1, -1)\", display: \"inline-block\" }\n\t\t\t\t\t\t\t: null\n\t\t\t\t\t}\n\t\t\t\t>\n\t\t\t\t\t{isAssigning ? \"...\" : displayName}\n\t\t\t\t</span>\n\t\t\t</button>\n\t\t);\n\t}\n\n\t_onAssign = () => {\n\t\tif (this.props.isAssigning) this.props.onAssignCancel();\n\t\telse this.props.onAssignStart();\n\t};\n}\n","import React, { Component } from \"react\";\nimport KeyBinding from \"../widgets/KeyBinding\";\nimport bus from \"../events\";\nimport config from \"../config\";\nimport strings from \"../locales\";\nimport styles from \"./Settings.module.css\";\nimport classNames from \"classnames\";\nimport _ from \"lodash\";\n\nconst BUTTONS = [\n\t{ name: \"BUTTON_LEFT\", displayName: \"<\" },\n\t{ name: \"BUTTON_RIGHT\", displayName: \">\" },\n\t{ name: \"BUTTON_UP\", displayName: \"v\", verticalMirror: true },\n\t{ name: \"BUTTON_DOWN\", displayName: \"v\" },\n\t{ name: \"BUTTON_B\", displayName: \"B\" },\n\t{ name: \"BUTTON_A\", displayName: \"A\" },\n\t{ name: \"BUTTON_SELECT\", displayName: \"SELECT\" },\n\t{ name: \"BUTTON_START\", displayName: \"START\" }\n];\n\nexport default class Settings extends Component {\n\tstate = { mappingButton: null };\n\n\tcomponentDidMount() {\n\t\twindow.addEventListener(\"keydown\", this._onKeyDown);\n\t}\n\n\tcomponentWillUnmount() {\n\t\twindow.removeEventListener(\"keydown\", this._onKeyDown);\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<div className={styles.settings}>\n\t\t\t\t<button\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tclassName={classNames(styles.closeButton, \"nes-btn\", \"is-error\")}\n\t\t\t\t\tonClick={this._onClose}\n\t\t\t\t>\n\t\t\t\t\tx\n\t\t\t\t</button>\n\n\t\t\t\t<button\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tclassName={classNames(\n\t\t\t\t\t\tstyles.setDefaultsButton,\n\t\t\t\t\t\t\"nes-btn\",\n\t\t\t\t\t\t\"is-warning\"\n\t\t\t\t\t)}\n\t\t\t\t\tonClick={this._onSetDefaults}\n\t\t\t\t>\n\t\t\t\t\t{strings.setDefaults}\n\t\t\t\t</button>\n\n\t\t\t\t<section\n\t\t\t\t\tclassName={classNames(\"nes-container\", \"is-dark\", \"with-title\")}\n\t\t\t\t>\n\t\t\t\t\t<div className=\"title\">{strings.sound}</div>\n\n\t\t\t\t\t<div>\n\t\t\t\t\t\t{config.soundOptions.map((it) => (\n\t\t\t\t\t\t\t<label key={it.name}>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\ttype=\"radio\"\n\t\t\t\t\t\t\t\t\tclassName=\"nes-radio is-dark\"\n\t\t\t\t\t\t\t\t\tname=\"sound\"\n\t\t\t\t\t\t\t\t\tchecked={config.options.sound === it.name}\n\t\t\t\t\t\t\t\t\tonChange={(e) => this._update(\"sound\", it.name)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<span>{it.name}</span>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t))}\n\t\t\t\t\t</div>\n\t\t\t\t</section>\n\t\t\t\t<br />\n\t\t\t\t<br />\n\n\t\t\t\t<section\n\t\t\t\t\tclassName={classNames(\"nes-container\", \"is-dark\", \"with-title\")}\n\t\t\t\t>\n\t\t\t\t\t<div className=\"title\">{strings.buffering}</div>\n\n\t\t\t\t\t<div>\n\t\t\t\t\t\t{config.bufferingOptions.map((it) => (\n\t\t\t\t\t\t\t<label key={it.name}>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\ttype=\"radio\"\n\t\t\t\t\t\t\t\t\tclassName=\"nes-radio is-dark\"\n\t\t\t\t\t\t\t\t\tname=\"buffering\"\n\t\t\t\t\t\t\t\t\tchecked={config.options.buffering === it.name}\n\t\t\t\t\t\t\t\t\tonChange={() => this._update(\"buffering\", it.name)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<span>{it.name}</span>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t))}\n\t\t\t\t\t</div>\n\t\t\t\t</section>\n\t\t\t\t<br />\n\t\t\t\t<br />\n\n\t\t\t\t<section\n\t\t\t\t\tclassName={classNames(\"nes-container\", \"is-dark\", \"with-title\")}\n\t\t\t\t>\n\t\t\t\t\t<div className=\"title\">{strings.crtEffect}</div>\n\n\t\t\t\t\t<div>\n\t\t\t\t\t\t{[true, false].map((it) => (\n\t\t\t\t\t\t\t<label key={it}>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\ttype=\"radio\"\n\t\t\t\t\t\t\t\t\tclassName=\"nes-radio is-dark\"\n\t\t\t\t\t\t\t\t\tname=\"crt\"\n\t\t\t\t\t\t\t\t\tchecked={config.options.crt === it}\n\t\t\t\t\t\t\t\t\tonChange={() => this._update(\"crt\", it)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<span>{strings[`enabled_${it}`]}</span>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t))}\n\t\t\t\t\t</div>\n\t\t\t\t</section>\n\t\t\t\t<br />\n\t\t\t\t<br />\n\n\t\t\t\t<section\n\t\t\t\t\tclassName={classNames(\"nes-container\", \"is-dark\", \"with-title\")}\n\t\t\t\t>\n\t\t\t\t\t<div className=\"title\">{strings.input}</div>\n\n\t\t\t\t\t{BUTTONS.map((button) => (\n\t\t\t\t\t\t<KeyBinding\n\t\t\t\t\t\t\tkey={button.name}\n\t\t\t\t\t\t\tname={button.name}\n\t\t\t\t\t\t\tverticalMirror={button.verticalMirror}\n\t\t\t\t\t\t\tdisplayName={button.displayName}\n\t\t\t\t\t\t\tisAssigning={this.state.mappingButton === button.name}\n\t\t\t\t\t\t\tonAssignStart={() =>\n\t\t\t\t\t\t\t\tthis.setState({ mappingButton: button.name })\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tonAssignCancel={() => this.setState({ mappingButton: null })}\n\t\t\t\t\t\t/>\n\t\t\t\t\t))}\n\t\t\t\t</section>\n\t\t\t</div>\n\t\t);\n\t}\n\n\t_update(property, value) {\n\t\t_.set(config.options, property, value);\n\t\tconfig.save();\n\t\tthis._notify();\n\t}\n\n\t_notify() {\n\t\tbus.emit(\"volume\", config.sound.gain);\n\t\tbus.emit(\"keymap\");\n\n\t\tconst container = document.querySelector(\"#container\");\n\t\tif (config.options.crt) container.classList.add(\"crt\");\n\t\telse container.classList.remove(\"crt\");\n\n\t\tthis.forceUpdate();\n\t}\n\n\t_onClose = () => {\n\t\tbus.emit(\"closeSettings\");\n\t};\n\n\t_onSetDefaults = () => {\n\t\tconfig.reset();\n\t\tthis._notify();\n\t};\n\n\t_onAssign = () => {\n\t\tif (this.props.isAssigning) return;\n\n\t\tthis.props.onAssignStart();\n\t\twindow.addEventListener(\"keydown\", this._onKeyDown);\n\t};\n\n\t_onKeyDown = (e) => {\n\t\tif (!this.state.mappingButton) return;\n\n\t\te.preventDefault();\n\n\t\tconst oldKey = _.findKey(\n\t\t\tconfig.options.input,\n\t\t\t(it) => it === this.state.mappingButton\n\t\t);\n\t\tconst newKey = e.key;\n\n\t\tdelete config.options.input[oldKey];\n\t\tconfig.options.input[newKey] = this.state.mappingButton;\n\t\tconfig.save();\n\t\tthis._notify();\n\n\t\tthis.setState({ mappingButton: null });\n\t};\n}\n","import React, { Component } from \"react\";\nimport Loader from \"react-loader-spinner\";\nimport Settings from \"./Settings\";\nimport bus from \"../events\";\nimport styles from \"./Overlay.module.css\";\nimport classNames from \"classnames\";\n\nexport default class Overlay extends Component {\n\tstate = { isSettingsMenuOpen: false, isLoading: false, message: null };\n\n\trender() {\n\t\tconst { isVisible } = this;\n\t\tconst { isSettingsMenuOpen, isLoading, message } = this.state;\n\n\t\treturn (\n\t\t\t<div className={classNames(styles.overlay, isVisible && styles.show)}>\n\t\t\t\t<div\n\t\t\t\t\tclassName={classNames(styles.loader, message == null && styles.dark)}\n\t\t\t\t>\n\t\t\t\t\t{isSettingsMenuOpen ? (\n\t\t\t\t\t\t<Settings />\n\t\t\t\t\t) : message != null ? (\n\t\t\t\t\t\t<div className={styles.message}>{message}</div>\n\t\t\t\t\t) : (\n\t\t\t\t\t\tisLoading && (\n\t\t\t\t\t\t\t<Loader type=\"Watch\" color=\"#CCCCCC\" height=\"50\" width=\"50\" />\n\t\t\t\t\t\t)\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t}\n\n\tcomponentDidMount() {\n\t\tbus\n\t\t\t.on(\"isLoading\", (isLoading) => {\n\t\t\t\tthis.setState({ isLoading });\n\t\t\t})\n\t\t\t.on(\"message\", (message) => {\n\t\t\t\tthis.setState({ isLoading: false, message });\n\t\t\t})\n\t\t\t.on(\"openSettings\", () => {\n\t\t\t\tthis.setState({ isSettingsMenuOpen: true });\n\t\t\t})\n\t\t\t.on(\"closeSettings\", () => {\n\t\t\t\tthis.setState({ isSettingsMenuOpen: false });\n\t\t\t});\n\t}\n\n\tcomponentWillUnmount() {\n\t\tbus.removeListener(\"isLoading\");\n\t\tbus.removeListener(\"message\");\n\t\tbus.removeListener(\"openSettings\");\n\t\tbus.removeListener(\"closeSettings\");\n\t}\n\n\tget isVisible() {\n\t\treturn (\n\t\t\tthis.state.isSettingsMenuOpen ||\n\t\t\tthis.state.isLoading ||\n\t\t\tthis.state.message != null\n\t\t);\n\t}\n}\n","import React, { Component } from \"react\";\n\nconst SCREEN_WIDTH = 256;\nconst SCREEN_HEIGHT = 240;\n\nexport default class TVNoise extends Component {\n\trender() {\n\t\treturn (\n\t\t\t<canvas\n\t\t\t\tstyle={{ width: \"100%\", height: \"100%\", borderRadius: 8 }}\n\t\t\t\twidth={SCREEN_WIDTH}\n\t\t\t\theight={SCREEN_HEIGHT}\n\t\t\t\tref={(canvas) => {\n\t\t\t\t\tif (canvas) this._initCanvas(canvas);\n\t\t\t\t}}\n\t\t\t/>\n\t\t);\n\t}\n\n\tcomponentWillUnmount() {\n\t\tcancelAnimationFrame(this._frameId);\n\t}\n\n\t_initCanvas(canvas) {\n\t\tconst self = this;\n\t\tconst context = canvas.getContext(\"2d\");\n\n\t\tfunction noise(ctx) {\n\t\t\tlet w = ctx.canvas.width,\n\t\t\t\th = ctx.canvas.height,\n\t\t\t\tidata = ctx.createImageData(w, h),\n\t\t\t\tbuffer32 = new Uint32Array(idata.data.buffer),\n\t\t\t\tlen = buffer32.length,\n\t\t\t\ti = 0;\n\n\t\t\tfor (; i < len; ) buffer32[i++] = ((255 * Math.random()) | 0) << 24;\n\n\t\t\tctx.putImageData(idata, 0, 0);\n\t\t}\n\n\t\tlet toggle = true;\n\t\t(function loop() {\n\t\t\ttoggle = !toggle;\n\t\t\tif (toggle) {\n\t\t\t\tself._frameId = requestAnimationFrame(loop);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tnoise(context);\n\t\t\tself._frameId = requestAnimationFrame(loop);\n\t\t})();\n\t}\n}\n","import cleanQueryString from \"./cleanQueryString\";\nimport ellipsize from \"./ellipsize\";\n\nexport default { cleanQueryString, ellipsize };\n","export default () => {\n\tlet url;\n\turl = window.location.href;\n\turl = url.replace(url.substring(url.indexOf(\"?\")), \"\");\n\turl = url.substring(url.indexOf(\"//\") + 2);\n\turl = url.substring(url.indexOf(\"/\"));\n\twindow.history.replaceState({}, \"\", url);\n};\n","export default (string, limit) =>\n\t`${string.substring(0, limit)}${string.length > limit ? \"\" : \"\"}`;\n","import React, { Component } from \"react\";\nimport config from \"../config\";\nimport strings from \"../locales\";\nimport helpers from \"../gui/helpers\";\nimport bus from \"../events\";\nimport styles from \"./Controls.module.css\";\nimport classNames from \"classnames\";\nimport _ from \"lodash\";\n\nconst TRICK_TIME = 100;\nconst FRIENDLY_NAMES = {\n\tArrowLeft: \"<\",\n\tArrowRight: \">\",\n\tArrowUp: \"~v\",\n\tArrowDown: \"v\",\n\t\" \": \"[Space]\"\n};\n\nexport default class Controls extends Component {\n\trender() {\n\t\tconst upKey = this._keyFor(\"BUTTON_UP\");\n\t\tconst isUpArrow = upKey === \"~v\";\n\n\t\treturn (\n\t\t\t<div className={styles.controls} id=\"controls\">\n\t\t\t\t<b className={classNames(styles.title, styles.centered)}>\n\t\t\t\t\t{strings.controls}\n\t\t\t\t</b>\n\t\t\t\t<br />\n\t\t\t\t{this.usesGamepad ? (\n\t\t\t\t\t<div className={styles.centered}>{strings.yourXboxController}</div>\n\t\t\t\t) : (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<div className={styles.controller}>\n\t\t\t\t\t\t\t<span className={styles.dpad}>\n\t\t\t\t\t\t\t\t<span>{this._keyFor(\"BUTTON_LEFT\")}</span>{\" \"}\n\t\t\t\t\t\t\t\t<span>{this._keyFor(\"BUTTON_RIGHT\")}</span>{\" \"}\n\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\tstyle={\n\t\t\t\t\t\t\t\t\t\tisUpArrow\n\t\t\t\t\t\t\t\t\t\t\t? { transform: \"scale(1, -1)\", display: \"inline-block\" }\n\t\t\t\t\t\t\t\t\t\t\t: null\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{isUpArrow ? \"v\" : upKey}\n\t\t\t\t\t\t\t\t</span>{\" \"}\n\t\t\t\t\t\t\t\t<span>{this._keyFor(\"BUTTON_DOWN\")}</span>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span className={styles.buttons}>\n\t\t\t\t\t\t\t\t{this._keyFor(\"BUTTON_B\")} {this._keyFor(\"BUTTON_A\")}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className={styles.centered}>\n\t\t\t\t\t\t\t{this._keyFor(\"BUTTON_SELECT\")} {this._keyFor(\"BUTTON_START\")}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t);\n\t}\n\n\tcomponentDidMount() {\n\t\tbus.on(\"keymap\", () => {\n\t\t\tbus.emit(\"keymap-updated\");\n\t\t\tthis.forceUpdate();\n\n\t\t\tconst element = document.querySelector(\"#controls\");\n\t\t\telement.classList.remove(\"blink\");\n\t\t\tsetTimeout(() => element.classList.add(\"blink\"), TRICK_TIME);\n\t\t});\n\n\t\twindow.addEventListener(\"gamepadconnected\", this._onGamepadConnected);\n\t}\n\n\tcomponentWillUnmount() {\n\t\tbus.removeListener(\"keymap\");\n\t\twindow.removeEventListener(\"gamepadconnected\");\n\t}\n\n\t_onGamepadConnected = (e) => {\n\t\tif (e.gamepad.mapping !== \"standard\") return;\n\n\t\tthis.usesGamepad = true;\n\t\tthis.forceUpdate();\n\t};\n\n\t_keyFor(button) {\n\t\tconst key = _.findKey(config.options.input, (it) => it === button);\n\t\tif (!key) return \"[?]\";\n\n\t\treturn this._format(key);\n\t}\n\n\t_format(key) {\n\t\treturn (\n\t\t\tFRIENDLY_NAMES[key] ||\n\t\t\t(key.length === 1 ? key.toUpperCase() : `[${helpers.ellipsize(key, 6)}]`)\n\t\t);\n\t}\n}\n","import React, { Component } from \"react\";\nimport bus from \"../events\";\nimport styles from \"./SettingsButton.module.css\";\nimport strings from \"../locales\";\n\nexport default class SettingsButton extends Component {\n\trender() {\n\t\treturn (\n\t\t\t<div className={styles.button}>\n\t\t\t\t<button\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\ttabIndex=\"-1\"\n\t\t\t\t\tclassName=\"nes-btn\"\n\t\t\t\t\tonClick={this._onClick}\n\t\t\t\t>\n\t\t\t\t\t{strings.settings}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t);\n\t}\n\n\t_onClick = () => {\n\t\tbus.emit(\"openSettings\");\n\t};\n}\n","import React, { Component } from \"react\";\nimport Emulator from \"../emulator\";\nimport InviteHeader from \"./InviteHeader\";\nimport JoinHeader from \"./JoinHeader\";\nimport Overlay from \"./Overlay\";\nimport Header from \"../widgets/Header\";\nimport TVNoise from \"../widgets/TVNoise\";\nimport Controls from \"../widgets/Controls\";\nimport SettingsButton from \"../widgets/SettingsButton\";\nimport helpers from \"./helpers\";\nimport config from \"../config\";\nimport bus from \"../events\";\nimport styles from \"./PlayScreen.module.css\";\nimport strings from \"../locales\";\nimport classNames from \"classnames\";\nimport quarto from \"../assets/quarto.nes\";\nimport _ from \"lodash\";\n\n// DEBUG\nwindow.bus = require(\"../events\").default;\nwindow.config = require(\"../config\").default;\n\nexport default class PlayScreen extends Component {\n\tstate = { rom: null, syncer: null };\n\n\trender() {\n\t\tconst { token } = this.props;\n\t\tconst { rom, syncer } = this.state;\n\n\t\treturn (\n\t\t\t<div className={styles.app}>\n\t\t\t\t{syncer ? (\n\t\t\t\t\t<Header>{strings.connected}</Header>\n\t\t\t\t) : token ? (\n\t\t\t\t\t<JoinHeader\n\t\t\t\t\t\tonSyncer={this._onSyncer}\n\t\t\t\t\t\tonError={this._onError}\n\t\t\t\t\t\ttoken={token}\n\t\t\t\t\t/>\n\t\t\t\t) : (\n\t\t\t\t\t<InviteHeader\n\t\t\t\t\t\tonSyncer={this._onSyncer}\n\t\t\t\t\t\tonError={this._onError}\n\t\t\t\t\t\tneedsRom={!rom}\n\t\t\t\t\t/>\n\t\t\t\t)}\n\n\t\t\t\t{\n\t\t\t\t\t<div className={styles.main}>\n\t\t\t\t\t\t<section\n\t\t\t\t\t\t\tclassName={classNames(\n\t\t\t\t\t\t\t\tstyles.gameContainer,\n\t\t\t\t\t\t\t\t\"nes-container\",\n\t\t\t\t\t\t\t\t\"is-dark\",\n\t\t\t\t\t\t\t\t\"with-title\"\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div className={styles.overlay}>\n\t\t\t\t\t\t\t\t<Overlay />\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{rom ? (\n\t\t\t\t\t\t\t\t<Emulator\n\t\t\t\t\t\t\t\t\trom={rom}\n\t\t\t\t\t\t\t\t\tsyncer={syncer}\n\t\t\t\t\t\t\t\t\tonStartPressed={this._onStartPressed}\n\t\t\t\t\t\t\t\t\tonError={this._onError}\n\t\t\t\t\t\t\t\t\tref={(ref) => (this.emulator = ref)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t<TVNoise />\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</section>\n\t\t\t\t\t</div>\n\t\t\t\t}\n\n\t\t\t\t<div className={styles.controls}>\n\t\t\t\t\t<Controls />\n\t\t\t\t</div>\n\n\t\t\t\t<div className={styles.menu}>\n\t\t\t\t\t<SettingsButton />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t}\n\n\tcomponentDidMount() {\n\t\twindow.addEventListener(\"dragover\", this._ignore);\n\t\twindow.addEventListener(\"dragenter\", this._ignore);\n\t\twindow.addEventListener(\"drop\", this._onFileDrop);\n\t\twindow.addEventListener(\"DOMContentLoaded\", this._onInitLoad);\n\t\tif (config.options.crt)\n\t\t\tdocument.querySelector(\"#container\").classList.add(\"crt\");\n\t}\n\n\tcomponentWillUnmount() {\n\t\twindow.removeEventListener(\"dragover\", this._ignore);\n\t\twindow.removeEventListener(\"dragenter\", this._ignore);\n\t\twindow.removeEventListener(\"drop\", this._onFileDrop);\n\t\twindow.addEventListener(\"DOMContentLoaded\", this._onInitLoad);\n\t}\n\n\t_onSyncer = (syncer) => {\n\t\tthis.setState({ syncer });\n\n\t\tsyncer.on(\"rom\", (rom) => {\n\t\t\tthis._loadRom(rom, () => syncer.initializeEmulator(this.emulator), false);\n\t\t});\n\t\tsyncer.on(\"start\", () => this.emulator && this.emulator.start());\n\n\t\tsyncer.initializeRom(this.state.rom);\n\t};\n\n\t_loadRom(rom, callback = _.noop, start = true) {\n\t\tbus.emit(\"message\", null);\n\n\t\tthis.setState({ rom }, () => {\n\t\t\tcallback();\n\t\t\tif (start) this.emulator.start();\n\t\t});\n\t}\n\n\t_onInitLoad = (e) => {\n\t\tloadBinary(quarto, (err, data) => {\n\t\t\tif (err) {\n\t\t\t\tthis.setState({ error: `Error loading ROM: ${err.message}` });\n\t\t\t} else {\n\t\t\t\tthis._loadRom(string_to_buffer(data));\n\t\t\t}\n\t\t});\n\t};\n\n\t_onFileDrop = (e) => {\n\t\te.preventDefault();\n\n\t\tconst file = _.first(e.dataTransfer.files);\n\t\tconst reader = new FileReader();\n\t\tif (!file) return;\n\n\t\treader.onload = (event) => {\n\t\t\tconst rom = event.target.result;\n\n\t\t\tif (this.state.syncer) this.state.syncer.updateRom(rom);\n\t\t\telse this._loadRom(event.target.result);\n\t\t};\n\n\t\treader.readAsArrayBuffer(file);\n\t};\n\n\t_ignore = (e) => {\n\t\te.stopPropagation();\n\t\te.preventDefault();\n\t};\n\n\t_onStartPressed = () => {\n\t\tif (!this.state.syncer) return;\n\t\tthis.state.syncer.onStartPressed();\n\t};\n\n\t_onError = (error, reset = true) => {\n\t\tthis.setState({ rom: null });\n\t\tbus.emit(\"message\", error || strings.errors.connectionFailed);\n\t\tif (!reset) return;\n\n\t\tthis.setState({ syncer: null });\n\t\thelpers.cleanQueryString();\n\t\twindow.location.href = \"#/\";\n\t};\n}\n\nexport function loadBinary(path, callback, handleProgress) {\n\tvar req = new XMLHttpRequest();\n\treq.open(\"GET\", path);\n\treq.overrideMimeType(\"text/plain; charset=x-user-defined\");\n\treq.onload = function() {\n\t\tif (this.status === 200) {\n\t\t\tif (req.responseText.match(/^<!doctype html>/i)) {\n\t\t\t\t// Got HTML back, so it is probably falling back to index.html due to 404\n\t\t\t\treturn callback(new Error(\"Page not found\"));\n\t\t\t}\n\n\t\t\tcallback(null, this.responseText);\n\t\t} else if (this.status === 0) {\n\t\t\t// Aborted, so ignore error\n\t\t} else {\n\t\t\tcallback(new Error(req.statusText));\n\t\t}\n\t};\n\treq.onerror = function() {\n\t\tcallback(new Error(req.statusText));\n\t};\n\treq.onprogress = handleProgress;\n\treq.send();\n\treturn req;\n}\n\nfunction string_to_buffer(src) {\n\treturn new Uint8Array(\n\t\t[].map.call(src, function(c) {\n\t\t\treturn c.charCodeAt(0);\n\t\t})\n\t).buffer;\n}\n","import React, { PureComponent } from \"react\";\nimport PlayScreen from \"./gui/PlayScreen\";\nimport querystring from \"query-string\";\nimport quickp2p, { SimpleStore } from \"quickp2p\";\n\nquickp2p.setStore(\n\tnew SimpleStore(\"https://simple-key-value-store.herokuapp.com\")\n);\n\nexport default class App extends PureComponent {\n\trender() {\n\t\tconst route = window.location.hash;\n\n\t\tif (route.startsWith(\"#/join\"))\n\t\t\treturn <PlayScreen token={this.inviteToken} />;\n\t\telse return <PlayScreen />;\n\t}\n\n\tcomponentWillMount() {\n\t\tthis._listener = window.addEventListener(\"hashchange\", (e) => {\n\t\t\tthis.forceUpdate();\n\t\t});\n\t}\n\n\tcomponentWillUnmount() {\n\t\twindow.removeEventListener(\"hashchange\", this._listener);\n\t}\n\n\tget inviteToken() {\n\t\treturn querystring.parse(window.location.search).token;\n\t}\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\nimport \"nes.css/css/nes.css\";\nimport \"./index.css\";\nimport \"./crt.css\";\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"app\":\"PlayScreen_app__3Zira\",\"main\":\"PlayScreen_main__ZoP3v\",\"gameContainer\":\"PlayScreen_gameContainer__3iDy2\",\"overlay\":\"PlayScreen_overlay__1mLt-\",\"controls\":\"PlayScreen_controls__2M9W0\",\"menu\":\"PlayScreen_menu__1suD-\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"overlay\":\"Overlay_overlay__1-57h\",\"show\":\"Overlay_show__7sI-P\",\"loader\":\"Overlay_loader__2CJwP\",\"dark\":\"Overlay_dark__2qTZW\",\"message\":\"Overlay_message__3ipYG\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"settings\":\"Settings_settings__--uDf\",\"closeButton\":\"Settings_closeButton__3109z\",\"setDefaultsButton\":\"Settings_setDefaultsButton__3QNz7\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"balloon\":\"BalloonMessage_balloon__34HFR\",\"character\":\"BalloonMessage_character__1u5Fu\"};","import EventEmitter from \"eventemitter3\";\n\nexport default new EventEmitter();\n","import bus from \"./bus\";\n\nexport default bus;\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"screen\":\"Screen_screen__3WUiw\"};","module.exports = __webpack_public_path__ + \"static/media/halu.365ed8d4.svg\";","// extracted by mini-css-extract-plugin\nmodule.exports = {\"button\":\"SettingsButton_button__346-l\"};","module.exports = __webpack_public_path__ + \"static/media/quarto.7cbcbb98.nes\";","const KEY = \"options\";\nconst HALF_VOLUME = \"50%\";\nconst DISABLED = \"Disabled\";\n\nclass Config {\n\tconstructor() {\n\t\tthis.options = this.defaultOptions;\n\t\tthis.load();\n\t}\n\n\tsave() {\n\t\tlocalStorage.setItem(KEY, JSON.stringify(this.options));\n\t}\n\n\tload() {\n\t\ttry {\n\t\t\tthis.options =\n\t\t\t\tJSON.parse(localStorage.getItem(KEY)) || this.defaultOptions;\n\t\t} catch (e) {\n\t\t\tthis.reset();\n\t\t}\n\t}\n\n\treset() {\n\t\tthis.options = this.defaultOptions;\n\t\tthis.save();\n\t}\n\n\tget sound() {\n\t\treturn this.soundOptions.find((it) => it.name === this.options.sound);\n\t}\n\n\tget buffering() {\n\t\treturn this.bufferingOptions.find(\n\t\t\t(it) => it.name === this.options.buffering\n\t\t);\n\t}\n\n\tget defaultOptions() {\n\t\treturn {\n\t\t\tsound: HALF_VOLUME,\n\t\t\tbuffering: DISABLED,\n\t\t\tcrt: true,\n\t\t\tinput: {\n\t\t\t\t\" \": \"BUTTON_A\",\n\t\t\t\td: \"BUTTON_B\",\n\t\t\t\tDelete: \"BUTTON_SELECT\",\n\t\t\t\tEnter: \"BUTTON_START\",\n\t\t\t\tArrowUp: \"BUTTON_UP\",\n\t\t\t\tArrowDown: \"BUTTON_DOWN\",\n\t\t\t\tArrowLeft: \"BUTTON_LEFT\",\n\t\t\t\tArrowRight: \"BUTTON_RIGHT\"\n\t\t\t}\n\t\t};\n\t}\n\n\tget soundOptions() {\n\t\treturn [\n\t\t\t{ name: \"100%\", gain: 1 },\n\t\t\t{ name: \"90%\", gain: 0.9 },\n\t\t\t{ name: \"75%\", gain: 0.75 },\n\t\t\t{ name: HALF_VOLUME, gain: 0.5 },\n\t\t\t{ name: \"25%\", gain: 0.25 },\n\t\t\t{ name: \"10%\", gain: 0.1 },\n\t\t\t{ name: \"0%\", gain: 0 }\n\t\t];\n\t}\n\n\tget bufferingOptions() {\n\t\treturn [\n\t\t\t{\n\t\t\t\tname: DISABLED,\n\t\t\t\tmasterBufferLimit: 3,\n\t\t\t\tminBufferSize: 1,\n\t\t\t\tmaxBufferSize: 1\n\t\t\t},\n\t\t\t{ name: \"Low\", masterBufferLimit: 3, minBufferSize: 1, maxBufferSize: 2 },\n\t\t\t{\n\t\t\t\tname: \"Medium\",\n\t\t\t\tmasterBufferLimit: 5,\n\t\t\t\tminBufferSize: 2,\n\t\t\t\tmaxBufferSize: 3\n\t\t\t},\n\t\t\t{ name: \"High\", masterBufferLimit: 5, minBufferSize: 3, maxBufferSize: 5 }\n\t\t];\n\t}\n}\n\nexport default new Config();\n"],"sourceRoot":""}